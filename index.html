<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Glossy AI Chat — WebLLM Free</title>
  <style>
    body { background:#0b0f14; color:white; font-family:sans-serif; margin:0; }
    .app { max-width:800px; margin:auto; padding:20px; display:flex; flex-direction:column; gap:10px; }
    .chat { flex:1; min-height:400px; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; overflow:auto; }
    .msg { margin:5px 0; padding:8px; border-radius:6px; }
    .user { background:rgba(16,185,129,0.2); }
    .assistant { background:rgba(124,58,237,0.2); }
    textarea { width:100%; padding:10px; border-radius:6px; border:none; resize:none; }
    button { padding:10px; border:none; border-radius:6px; background:#7c3aed; color:white; font-weight:bold; cursor:pointer; }
  </style>
</head>
<body>
<div class="app">
  <h1>Glossy AI Chat — Free (WebLLM)</h1>
  <div id="chat" class="chat"></div>
  <textarea id="input" rows="3" placeholder="Type your message..."></textarea>
  <button id="send">Send</button>
</div>
<script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm/dist/web-llm.min.js"></script>
<script>
const chatEl = document.getElementById('chat');
const inputEl = document.getElementById('input');
const sendBtn = document.getElementById('send');
let messages = [];
let enginePromise = null;

async function getEngine(){
  if(!navigator.gpu) { alert("WebGPU not supported in this browser."); throw new Error("No WebGPU"); }
  if(!enginePromise){
    const worker = new Worker("https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm/dist/worker.js", {type:"module"});
    enginePromise = window.webllm.createWebWorkerMLCEngine(worker, { model:"Phi-3-mini-4k-instruct-q4f32_1" });
  }
  return enginePromise;
}

function render(){
  chatEl.innerHTML = messages.map(m=>`<div class="msg ${m.role}">${m.content}</div>`).join("");
  chatEl.scrollTop = chatEl.scrollHeight;
}

async function sendMessage(){
  const text = inputEl.value.trim();
  if(!text) return;
  messages.push({role:"user", content:text});
  render();
  inputEl.value="";
  const idx = messages.push({role:"assistant", content:""}) - 1;
  const engine = await getEngine();
  await engine.chat.completions.create({messages, stream:true}, (evt)=>{
    const delta = evt?.choices?.[0]?.delta?.content || "";
    if(delta){ messages[idx].content += delta; render(); }
  });
}

sendBtn.onclick = sendMessage;
</script>
</body>
</html>